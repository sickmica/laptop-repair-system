<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>笔记本维修记录系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
      <link rel="icon" href="icon/橘猫.svg" type="image/x-icon"> <!-- 网站图标 -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- 配置Tailwind自定义颜色和深色模式 -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        neutral: '#F5F7FA',
                        danger: '#F53F3F',
                        success: '#00B42A',
                        statusResolved: '#00B42A',
                        statusRepairing: '#FF7D00',
                        statusWaiting: '#165DFF',
                        statusUnrepairable: '#F53F3F'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .form-input-focus {
                @apply focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none;
            }
            .card-shadow {
                @apply shadow-lg hover:shadow-xl transition-shadow duration-300;
            }
            .dropdown-item-hover {
                @apply hover:bg-primary/5 hover:text-primary transition-colors cursor-pointer;
            }
            .dropdown-active {
                @apply bg-primary/10 text-primary font-medium;
            }
            .status-pill {
                @apply px-3 py-1.5 inline-flex items-center text-xs font-medium rounded-full transition-all duration-200 cursor-pointer;
            }
            .status-pill-active {
                @apply shadow-md scale-105;
            }
            .pagination-item {
                @apply px-3 py-1.5 rounded border hover:border-primary hover:text-primary transition-colors;
            }
            .pagination-item.active {
                @apply bg-primary text-white border-primary;
            }
            .table-container {
                @apply w-full overflow-x-auto;
            }
            .full-width-table {
                @apply w-full min-w-[900px] divide-y divide-gray-200 dark:divide-gray-700 table-auto;
            }
            .theme-toggle {
                @apply relative w-12 h-6 rounded-full transition-colors duration-300 cursor-pointer flex items-center p-1;
            }
            .theme-toggle-circle {
                @apply absolute w-4 h-4 rounded-full bg-white transition-transform duration-300 shadow-md;
            }
            .table-row-selected {
                @apply bg-primary/5 dark:bg-primary/10;
            }
            /* 毛玻璃效果工具类 */
            .glass-effect {
                @apply bg-white/80 dark:bg-gray-800/80
                       backdrop-blur-md
                       border border-white/20 dark:border-gray-700/20;
            }
            .glass-header {
                @apply bg-white/80 dark:bg-gray-800/80
                       backdrop-blur-md;
            }
            .glass-input {
                @apply bg-white/70 dark:bg-gray-700/70
                       backdrop-blur-sm;
            }
            
            /* 新增动画效果 */
            .floating-animation {
                animation: floating 3s ease-in-out infinite;
            }
            .pulse-glow {
                animation: pulse-glow 2s ease-in-out infinite alternate;
            }
            .slide-in {
                animation: slideIn 0.5s ease-out forwards;
            }
            .bounce-in {
                animation: bounceIn 0.6s ease-out forwards;
            }
            .typewriter {
                overflow: hidden;
                border-right: 2px solid;
                white-space: nowrap;
                animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
            }
            
            /* 修复下拉框层级问题 */
            .dropdown-container {
                position: relative;
                z-index: 50; /* 确保父容器有适当的z-index */
            }
            
            .model-dropdown {
                position: absolute;
                z-index: 9999; /* 非常高的z-index确保在最顶层 */
                margin-top: 0.25rem;
                width: 100%;
                background: white;
                border-radius: 0.5rem;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
                border: 1px solid rgba(209, 213, 219, 0.5);
                max-height: 15rem;
                overflow-y: auto;
            }
            
            .dark .model-dropdown {
                background: #1f2937;
                border-color: rgba(75, 85, 99, 0.5);
            }
            
            /* 返回顶部按钮 */
            .back-to-top {
                position: fixed;
                bottom: 2rem;
                right: 2rem;
                width: 3rem;
                height: 3rem;
                border-radius: 50%;
                background: #165DFF;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
                box-shadow: 0 4px 12px rgba(22, 93, 255, 0.3);
                z-index: 100;
            }
            
            .back-to-top.visible {
                opacity: 1;
                visibility: visible;
            }
            
            .back-to-top:hover {
                background: #0e4fd8;
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(22, 93, 255, 0.4);
            }
        }
    </style>
    
    <!-- 深色模式样式 -->
    <style>
        .dark {
            color-scheme: dark;
        }
        
        .dark body {
            background-color: #121212;
            color: #e5e7eb;
        }
        
        .dark .bg-white {
            background-color: #1e1e1e;
        }
        
        .dark .bg-gray-50 {
            background-color: #2d2d2d;
        }
        
        .dark .text-gray-800 {
            color: #f3f4f6;
        }
        
        .dark .text-gray-700 {
            color: #e5e7eb;
        }
        
        .dark .text-gray-500 {
            color: #9ca3af;
        }
        
        .dark .border-gray-300 {
            border-color: #4b5563;
        }
        
        .dark .border-gray-200 {
            border-color: #374151;
        }
        
        .dark .border-gray-100 {
            border-color: #374151;
        }
        
        .dark .divide-gray-200 > :not([hidden]) ~ :not([hidden]) {
            border-color: #374151;
        }
        
        .dark .hover:bg-gray-300:hover {
            background-color: #4b5563;
        }
        
        .dark .bg-gray-200 {
            background-color: #374151;
        }
        
        .dark .dropdown-item-hover:hover {
            background-color: rgba(22, 93, 255, 0.2);
        }
        
        .dark .dropdown-active {
            background-color: rgba(22, 93, 255, 0.2);
        }
        
        /* 背景纹理 */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            z-index: -1;
        }

        /* 文字跳动动画 */
        @keyframes jumpIn {
            0% {
                transform: translateY(20px);
                opacity: 0;
            }
            60% {
                transform: translateY(-5px);
                opacity: 1;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .title-char {
            display: inline-block;
            animation: jumpIn 0.6s ease forwards;
            opacity: 0;
        }
        
        /* 新增动画关键帧 */
        @keyframes floating {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 5px rgba(22, 93, 255, 0.3);
            }
            100% {
                box-shadow: 0 0 15px rgba(22, 93, 255, 0.6);
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
            70% {
                transform: scale(0.9);
                opacity: 0.9;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #165DFF }
        }
        
        /* 笔记本图标动画 */
        .laptop-icon {
            transition: all 0.3s ease;
        }
        
        .laptop-icon:hover {
            transform: rotate(-5deg) scale(1.1);
        }
        
        /* 状态指示器动画 */
        .status-indicator {
            position: relative;
            overflow: hidden;
        }
        
        .status-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .status-indicator:hover::before {
            left: 100%;
        }
        
        /* 进度条动画 */
        .progress-bar {
            height: 4px;
            background: linear-gradient(90deg, #165DFF, #36CFC9);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        /* 粒子效果容器 */
        .particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        /* 霓虹效果 */
        .neon-text {
            text-shadow: 0 0 5px currentColor, 0 0 10px currentColor, 0 0 15px currentColor;
        }
        
        /* 加载动画 */
        .loading-dots:after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% {
                color: rgba(0,0,0,0);
                text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);
            }
            40% {
                color: currentColor;
                text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);
            }
            60% {
                text-shadow: .25em 0 0 currentColor, .5em 0 0 rgba(0,0,0,0);
            }
            80%, 100% {
                text-shadow: .25em 0 0 currentColor, .5em 0 0 currentColor;
            }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors duration-300">
    <!-- 粒子效果容器 -->
    <div id="particlesContainer" class="particles-container"></div>
    
    <!-- 进度指示器 -->
    <div id="globalProgress" class="progress-bar fixed top-0 left-0 z-50"></div>
    
    <!-- 返回顶部按钮 -->
    <div id="backToTop" class="back-to-top">
        <i class="fa fa-chevron-up"></i>
    </div>
    
    <div class="container mx-auto px-4 py-8 max-w-none">
        <!-- 头部添加主题切换按钮 -->
        <div class="flex justify-between items-center mb-4">
            <!-- 欢迎消息 -->
            <div id="welcomeMessage" class="text-sm text-gray-500 dark:text-gray-400 slide-in">
                <span id="greetingText" class="typewriter">欢迎使用笔记本维修记录系统</span>
                <span id="timeIndicator" class="ml-2"></span>
            </div>
            
            <div class="flex items-center gap-4">
                <!-- 系统状态指示器 -->
                <div id="systemStatus" class="flex items-center gap-2 px-3 py-1 rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-sm status-indicator">
                    <div class="w-2 h-2 rounded-full bg-green-500 pulse-glow"></div>
                    <span>系统运行正常</span>
                </div>
                
                <button id="themeToggle" class="theme-toggle bg-gray-200/80 dark:bg-primary/80 backdrop-blur-sm">
                    <span class="theme-toggle-circle transform dark:translate-x-6"></span>
                    <span class="absolute left-1.5 text-yellow-500 dark:opacity-0">
                        <i class="fa fa-sun-o"></i>
                    </span>
                    <span class="absolute right-1.5 text-blue-200 opacity-0 dark:opacity-100">
                        <i class="fa fa-moon-o"></i>
                    </span>
                </button>
            </div>
        </div>
        
        <!-- 浮动笔记本图标 -->
        <div class="flex justify-center mb-2">
            <div class="laptop-icon floating-animation text-4xl text-primary/60">
                <i class="fa fa-laptop"></i>
            </div>
        </div>
        
        <header class="mb-10 text-center max-w-4xl mx-auto glass-header rounded-xl p-6 card-shadow">
            <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-gray-800 dark:text-white mb-2" id="animatedTitle">
                <i class="fa fa-laptop text-primary mr-3 laptop-icon"></i>
                <span>笔记本维修记录系统</span>
            </h1>
            <p class="text-gray-500 dark:text-gray-400">填写维修信息，自动生成Excel记录</p>
            
            <!-- 统计信息卡片 -->
            <div class="grid grid-cols-3 gap-4 mt-6">
                <div class="text-center p-3 bg-primary/10 rounded-lg bounce-in" style="animation-delay: 0.1s">
                    <div class="text-2xl font-bold text-primary" id="totalRecordsCount">0</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">总记录数</div>
                </div>
                <div class="text-center p-3 bg-secondary/10 rounded-lg bounce-in" style="animation-delay: 0.2s">
                    <div class="text-2xl font-bold text-secondary" id="resolvedCount">0</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">已解决</div>
                </div>
                <div class="text-center p-3 bg-warning/10 rounded-lg bounce-in" style="animation-delay: 0.3s">
                    <div class="text-2xl font-bold text-orange-500" id="repairingCount">0</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">维修中</div>
                </div>
            </div>
        </header>
        
        <div class="max-w-7xl mx-auto grid md:grid-cols-3 gap-8 mb-8">
            <div class="md:col-span-2 glass-effect rounded-xl p-6 card-shadow">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-5 flex items-center">
                    <i class="fa fa-wrench text-primary mr-2 floating-animation" style="animation-delay: 0.2s"></i>
                    <span class="slide-in">维修信息录入</span>
                </h2>
                
                <form id="repairForm" class="space-y-5">
                    <div class="grid md:grid-cols-2 gap-5">
                        <div class="slide-in" style="animation-delay: 0.1s">
                            <label for="username" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">用户姓名 <span class="text-danger">*</span></label>
                            <input type="text" id="username" name="username" required
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 glass-input dark:text-white rounded-lg form-input-focus transition duration-200">
                        </div>
                        
                        <div class="slide-in" style="animation-delay: 0.2s">
                            <label for="employeeId" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">工号 <span class="text-danger">*</span></label>
                            <input type="text" id="employeeId" name="employeeId" required
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 glass-input dark:text-white rounded-lg form-input-focus transition duration-200">
                        </div>
                        
                        <div class="slide-in" style="animation-delay: 0.3s">
                            <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">邮箱 <span class="text-danger">*</span></label>
                            <input type="email" id="email" name="email" required
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 glass-input dark:text-white rounded-lg form-input-focus transition duration-200">
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-5">
                        <!-- 修复笔记本型号下拉框层级问题 -->
                        <div class="slide-in dropdown-container" style="animation-delay: 0.4s">
                            <label for="laptopModelInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">笔记本型号 <span class="text-danger">*</span></label>
                            <div class="relative">
                                <input type="text" id="laptopModelInput" placeholder="输入或选择笔记本型号" required
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 glass-input dark:text-white rounded-lg form-input-focus transition duration-200 pr-10">
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3 cursor-pointer" id="dropdownToggle">
                                    <i class="fa fa-chevron-down text-gray-400 transition-transform duration-200" id="dropdownArrow"></i>
                                </div>
                                
                                <!-- 修复后的下拉框，使用更高的z-index -->
                                <div id="laptopModelDropdown" class="model-dropdown hidden">
                                    <div class="p-2 border-b border-gray-100 dark:border-gray-700">
                                        <div class="relative">
                                            <input type="text" id="modelSearch" placeholder="搜索型号..."
                                                class="w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 glass-input dark:text-white rounded-lg focus:ring-1 focus:ring-primary focus:border-primary">
                                            <i class="fa fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                                        </div>
                                    </div>
                                    <ul id="modelOptions" class="p-1 text-sm">
                                        <!-- 选项将通过JS动态生成 -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="slide-in" style="animation-delay: 0.5s">
                            <label for="serialNumber" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">序列号 <span class="text-danger">*</span></label>
                            <input type="text" id="serialNumber" name="serialNumber" required
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 glass-input dark:text-white rounded-lg form-input-focus transition duration-200">
                        </div>
                    </div>
                    
                    <div class="slide-in" style="animation-delay: 0.6s">
                        <label for="faultDescription" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">故障描述 <span class="text-danger">*</span></label>
                        <textarea id="faultDescription" name="faultDescription" rows="3" required
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 glass-input dark:text-white rounded-lg form-input-focus transition duration-200"
                            placeholder="请详细描述笔记本出现的故障现象..."></textarea>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-5">
                        <div class="slide-in" style="animation-delay: 0.7s">
                            <label for="solveDate" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">问题提交日期 <span class="text-danger">*</span></label>
                            <input type="date" id="solveDate" name="solveDate" required
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 glass-input dark:text-white rounded-lg form-input-focus transition duration-200">
                        </div>
                        
                        <div class="slide-in" style="animation-delay: 0.8s">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">状态 <span class="text-danger">*</span></label>
                            <input type="hidden" id="status" name="status" required>
                            <div class="flex flex-wrap gap-2 mt-1" id="statusSelector">
                                <span class="status-pill bg-success/10 text-success border border-success/30 hover:bg-success/20 pulse-glow" data-status="已解决">
                                    <i class="fa fa-check-circle mr-1"></i>已解决
                                </span>
                                <span class="status-pill bg-statusRepairing/10 text-statusRepairing border border-statusRepairing/30 hover:bg-statusRepairing/20 pulse-glow" data-status="维修中">
                                    <i class="fa fa-cog mr-1"></i>维修中
                                </span>
                                <span class="status-pill bg-statusWaiting/10 text-statusWaiting border border-statusWaiting/30 hover:bg-statusWaiting/20 pulse-glow" data-status="待配件">
                                    <i class="fa fa-clock-o mr-1"></i>待配件
                                </span>
                                <span class="status-pill bg-statusUnrepairable/10 text-statusUnrepairable border border-statusUnrepairable/30 hover:bg-statusUnrepairable/20 pulse-glow" data-status="无法修复">
                                    <i class="fa fa-times-circle mr-1"></i>过保无法维修
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="slide-in" style="animation-delay: 0.9s">
                        <label for="comment" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">备注</label>
                        <textarea id="comment" name="comment" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 glass-input dark:text-white rounded-lg form-input-focus transition duration-200"
                            placeholder="请输入维修详情、处理方式等信息..."></textarea>
                    </div>
                    
                    <div class="flex flex-wrap gap-4 pt-2">
                        <button type="submit" id="addRecordBtn" 
                            class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition duration-200 flex items-center pulse-glow">
                            <i class="fa fa-plus-circle mr-2"></i>添加记录
                        </button>
                        <button type="button" id="editRecordBtn" disabled
                            class="px-6 py-3 bg-secondary text-white rounded-lg hover:bg-secondary/90 transition duration-200 flex items-center opacity-50 cursor-not-allowed">
                            <i class="fa fa-pencil mr-2"></i>编辑记录
                        </button>
                        <button type="button" id="downloadExcelBtn" 
                            class="px-6 py-3 bg-secondary text-white rounded-lg hover:bg-secondary/90 transition duration-200 flex items-center pulse-glow">
                            <i class="fa fa-download mr-2"></i>下载Excel
                        </button>
                        <button type="button" id="deleteSelectedBtn" disabled
                            class="px-6 py-3 bg-danger text-white rounded-lg hover:bg-danger/90 transition duration-200 flex items-center opacity-50 cursor-not-allowed">
                            <i class="fa fa-trash-o mr-2"></i>删除选中
                        </button>
                        <button type="button" id="clearRecordsBtn" 
                            class="px-6 py-3 bg-danger text-white rounded-lg hover:bg-danger/90 transition duration-200 flex items-center pulse-glow">
                            <i class="fa fa-trash mr-2"></i>清除记录
                        </button>
                        <button type="reset" 
                            class="px-6 py-3 bg-gray-200/80 dark:bg-gray-700/80 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-200 flex items-center backdrop-blur-sm">
                            <i class="fa fa-refresh mr-2"></i>重置
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="space-y-6">
                <div class="glass-effect rounded-xl p-5 card-shadow">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center">
                        <i class="fa fa-upload text-primary mr-2 floating-animation"></i>导入已有记录
                    </h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">上传现有的Excel文件，继续添加新记录</p>
                    <input type="file" id="excelFile" accept=".xlsx, .xls" 
                        class="w-full text-sm text-gray-500 dark:text-gray-400
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-lg file:border-0
                            file:text-sm file:font-medium
                            file:bg-primary file:text-white
                            hover:file:bg-primary/90 cursor-pointer">
                </div>
                
                <div class="glass-effect rounded-xl p-5 card-shadow">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center">
                        <i class="fa fa-history text-primary mr-2 floating-animation"></i>最近记录
                    </h3>
                    <div id="recentRecords" class="max-h-64 overflow-y-auto space-y-3 text-sm">
                        <p class="text-gray-500 dark:text-gray-400 italic text-center py-4">暂无记录</p>
                    </div>
                </div>
                
                <!-- 新增：快捷操作面板 -->
                <div class="glass-effect rounded-xl p-5 card-shadow">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center">
                        <i class="fa fa-bolt text-yellow-500 mr-2 floating-animation"></i>快捷操作
                    </h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button id="quickAdd" class="p-3 bg-primary/10 hover:bg-primary/20 rounded-lg transition-colors flex flex-col items-center justify-center">
                            <i class="fa fa-plus text-primary text-xl mb-1"></i>
                            <span class="text-xs text-gray-600 dark:text-gray-300">快速添加</span>
                        </button>
                        <button id="quickStats" class="p-3 bg-secondary/10 hover:bg-secondary/20 rounded-lg transition-colors flex flex-col items-center justify-center">
                            <i class="fa fa-chart-bar text-secondary text-xl mb-1"></i>
                            <span class="text-xs text-gray-600 dark:text-gray-300">数据统计</span>
                        </button>
                        <button id="quickExport" class="p-3 bg-green-500/10 hover:bg-green-500/20 rounded-lg transition-colors flex flex-col items-center justify-center">
                            <i class="fa fa-file-export text-green-500 text-xl mb-1"></i>
                            <span class="text-xs text-gray-600 dark:text-gray-300">快速导出</span>
                        </button>
                        <button id="quickSearch" class="p-3 bg-purple-500/10 hover:bg-purple-500/20 rounded-lg transition-colors flex flex-col items-center justify-center">
                            <i class="fa fa-search text-purple-500 text-xl mb-1"></i>
                            <span class="text-xs text-gray-600 dark:text-gray-300">搜索记录</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4 glass-effect rounded-xl p-6 card-shadow">
            <div class="flex justify-between items-center mb-5">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-white flex items-center">
                    <i class="fa fa-table text-primary mr-2"></i>记录表格预览
                    <span class="ml-3 text-sm font-normal text-gray-500 dark:text-gray-400">
                        <i class="fa fa-info-circle"></i> 点击行可选中记录进行操作
                    </span>
                </h2>
                
                <!-- 表格操作工具栏 -->
                <div class="flex items-center gap-2">
                    <div class="relative">
                        <input type="text" id="tableSearch" placeholder="搜索记录..." 
                            class="px-4 py-2 border border-gray-300 dark:border-gray-600 glass-input dark:text-white rounded-lg form-input-focus transition duration-200 text-sm">
                        <i class="fa fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                    </div>
                    <button id="refreshTable" class="p-2 bg-gray-200/80 dark:bg-gray-700/80 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-200">
                        <i class="fa fa-refresh text-gray-600 dark:text-gray-300"></i>
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table id="recordsTable" class="full-width-table">
                    <thead class="bg-gray-50/70 dark:bg-gray-700/70 backdrop-blur-sm">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-10">
                                <i class="fa fa-check-square-o"></i>
                            </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">用户姓名</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">工号</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">邮箱</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">笔记本型号</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">序列号</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" style="min-width: 200px;">故障描述</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">提交日期</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                            <span class="inline-flex items-center">
                                <i class="fa fa-info-circle text-primary mr-1" title="点击状态标签进行修改"></i>
                                状态
                            </span>
                        </th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider" style="min-width: 200px;">备注</th>
                        </tr>
                    </thead>
                    <tbody id="recordsTableBody" class="bg-white/60 dark:bg-gray-800/60 divide-y divide-gray-200/50 dark:divide-gray-700/50 backdrop-blur-sm">
                        <tr>
                            <td colspan="10" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400 italic">暂无记录，请添加维修记录</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div id="paginationControls" class="flex justify-between items-center mt-6 hidden">
                <div class="text-sm text-gray-500 dark:text-gray-400">
                    显示 <span id="showingRange"></span> 条，共 <span id="totalRecords"></span> 条记录
                </div>
                <div class="flex items-center gap-2">
                    <button id="prevPage" class="pagination-item disabled cursor-not-allowed dark:border-gray-600 dark:text-gray-300" disabled>
                        <i class="fa fa-chevron-left"></i>
                    </button>
                    <div id="pageNumbers" class="flex items-center gap-1"></div>
                    <button id="nextPage" class="pagination-item disabled cursor-not-allowed dark:border-gray-600 dark:text-gray-300" disabled>
                        <i class="fa fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
        
    </div>

    <script>
        // 存储所有维修记录
        let repairRecords = [];
        // 分页配置
        const paginationConfig = {
            pageSize: 10,  // 每页显示10条记录
            currentPage: 1  // 当前页码
        };
        // 选中的记录索引
        let selectedRecordIndices = [];
        // 当前编辑的记录索引
        let currentEditingIndex = -1;
        // 表头信息
        const headers = [
            "选择", "用户姓名", "工号", "邮箱", "笔记本型号", 
            "序列号", "故障描述", "问题解决日期", "状态", "备注"
        ];
        
        // 笔记本型号预选项
        const laptopModels = [
            "HP EliteBook 8 G1a 14 inch Notebook AI PC",
            "HP EB840/G7",
            "HP EB840/G8",
            "HP EliteBook 840/G11",
            "HP EliteBook 840/G10",
            "HP EliteBook 845/G8",
            "HP ZBook Firefly 14 G8",
            "HP ZBook Studio G7 15",
            "Dell Latitude 7420",
            "Microsoft Surface Pro",
            "Apple MacBook Air",
            "Apple MacBook Pro",
        ];
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('页面加载完成，开始初始化...');
            
            // 初始化标题文字跳动动画
            initTitleAnimation();
            
            // 初始化主题模式
            initThemeMode();
            
            // 从localStorage加载记录
            loadRecordsFromStorage();
            
            // 设置默认日期为今天
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('solveDate').value = today;
            
            // 初始化状态选择器
            initStatusSelector();
            
            // 初始化笔记本型号下拉选项
            initLaptopModelDropdown();
            
            // 单独处理清除记录按钮的事件绑定，确保DOM加载完成
            setupClearRecordsButton();
            
            // 初始化删除选中按钮事件
            initDeleteSelectedButton();
            
            // 初始化编辑按钮事件
            initEditButton();
            
            // 初始化其他事件监听
            initOtherEventListeners();
            
            // 初始化分页控件事件
            initPaginationEvents();
            
            // 初始化时检查是否需要显示分页控件
            updatePaginationControls();
            
            // 恢复滚动位置
            restoreScrollPosition();
            
            // 初始化新功能
            initNewFeatures();
            
            // 初始化返回顶部功能
            initBackToTop();
            
            // 页面加载完成后自动滚动到顶部
            scrollToTop();
        });

        // 初始化新功能
        function initNewFeatures() {
            // 初始化粒子效果
            initParticles();
            
            // 更新时间显示
            updateTimeDisplay();
            setInterval(updateTimeDisplay, 60000);
            
            // 初始化快捷操作
            initQuickActions();
            
            // 初始化表格搜索
            initTableSearch();
            
            // 初始化统计信息
            updateStatistics();
            
            // 初始化欢迎消息
            initWelcomeMessage();
        }
        
        // 初始化返回顶部功能
        function initBackToTop() {
            const backToTopBtn = document.getElementById('backToTop');
            
            // 点击返回顶部
            backToTopBtn.addEventListener('click', scrollToTop);
            
            // 监听滚动事件，显示/隐藏返回顶部按钮
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.add('visible');
                } else {
                    backToTopBtn.classList.remove('visible');
                }
            });
        }
        
        // 滚动到页面顶部
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // 初始化粒子效果
        function initParticles() {
            const container = document.getElementById('particlesContainer');
            const colors = ['#165DFF', '#36CFC9', '#FF7D00', '#00B42A'];
            
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'absolute rounded-full';
                particle.style.width = `${Math.random() * 6 + 2}px`;
                particle.style.height = particle.style.width;
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.opacity = `${Math.random() * 0.3 + 0.1}`;
                particle.style.animation = `floating ${Math.random() * 10 + 10}s ease-in-out infinite`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                container.appendChild(particle);
            }
        }
        
        // 更新时间显示
        function updateTimeDisplay() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const timeIndicator = document.getElementById('timeIndicator');
            
            let greeting = '';
            if (hours < 6) greeting = '深夜好';
            else if (hours < 12) greeting = '早上好';
            else if (hours < 14) greeting = '中午好';
            else if (hours < 18) greeting = '下午好';
            else greeting = '晚上好';
            
            timeIndicator.textContent = `${greeting} ${hours}:${minutes}`;
        }
        
        // 初始化快捷操作
        function initQuickActions() {
            // 快速添加
            document.getElementById('quickAdd').addEventListener('click', () => {
                document.getElementById('repairForm').scrollIntoView({ behavior: 'smooth' });
                document.getElementById('username').focus();
                showNotification('已跳转到添加表单', 'info');
            });
            
            // 数据统计
            document.getElementById('quickStats').addEventListener('click', () => {
                showStatisticsModal();
            });
            
            // 快速导出
            document.getElementById('quickExport').addEventListener('click', () => {
                downloadExcel();
            });
            
            // 快速搜索
            document.getElementById('quickSearch').addEventListener('click', () => {
                document.getElementById('tableSearch').focus();
                showNotification('请在搜索框中输入关键词', 'info');
            });
            
            // 刷新表格
            document.getElementById('refreshTable').addEventListener('click', () => {
                updateRecordsTable();
                showNotification('表格已刷新', 'success');
            });
        }
        
        // 初始化表格搜索
        function initTableSearch() {
            const searchInput = document.getElementById('tableSearch');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm) {
                    // 这里可以添加搜索逻辑
                    showNotification(`搜索: ${searchTerm}`, 'info');
                }
            });
        }
        
        // 更新统计信息
        function updateStatistics() {
            const total = repairRecords.length;
            const resolved = repairRecords.filter(r => r.status === '已解决').length;
            const repairing = repairRecords.filter(r => r.status === '维修中').length;
            
            document.getElementById('totalRecordsCount').textContent = total;
            document.getElementById('resolvedCount').textContent = resolved;
            document.getElementById('repairingCount').textContent = repairing;
            
            // 更新进度条
            const progressBar = document.getElementById('globalProgress');
            if (total > 0) {
                progressBar.style.width = '100%';
            } else {
                progressBar.style.width = '0%';
            }
        }
        
        // 初始化欢迎消息
        function initWelcomeMessage() {
            const messages = [
                "准备好记录新的维修任务了吗？",
                "系统运行稳定，随时为您服务",
                "今日已完成多项维修记录",
                "高效管理，从记录开始"
            ];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            
            setTimeout(() => {
                const greetingText = document.getElementById('greetingText');
                greetingText.textContent = randomMessage;
                greetingText.classList.add('typewriter');
            }, 4000);
        }
        
        // 显示统计模态框
        function showStatisticsModal() {
            const total = repairRecords.length;
            const statusCounts = {
                '已解决': repairRecords.filter(r => r.status === '已解决').length,
                '维修中': repairRecords.filter(r => r.status === '维修中').length,
                '待配件': repairRecords.filter(r => r.status === '待配件').length,
                '无法修复': repairRecords.filter(r => r.status === '无法修复').length
            };
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4 card-shadow bounce-in">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white">数据统计</h3>
                        <button class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" onclick="this.closest('.fixed').remove()">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center p-3 bg-primary/10 rounded-lg">
                                <div class="text-2xl font-bold text-primary">${total}</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300">总记录数</div>
                            </div>
                            <div class="text-center p-3 bg-green-500/10 rounded-lg">
                                <div class="text-2xl font-bold text-green-500">${statusCounts['已解决']}</div>
                                <div class="text-sm text-gray-600 dark:text-gray-300">已解决</div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            ${Object.entries(statusCounts).map(([status, count]) => `
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600 dark:text-gray-300">${status}</span>
                                    <span class="text-sm font-medium">${count}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end">
                        <button class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition duration-200" onclick="this.closest('.fixed').remove()">
                            关闭
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // 保存滚动位置
        function saveScrollPosition() {
            sessionStorage.setItem('scrollPosition', window.scrollY);
        }

        // 恢复滚动位置
        function restoreScrollPosition() {
            const savedPosition = sessionStorage.getItem('scrollPosition');
            if (savedPosition) {
                // 使用setTimeout确保DOM完全渲染
                setTimeout(() => {
                    window.scrollTo(0, parseInt(savedPosition));
                    // 清除保存的位置，避免下次加载时再次滚动
                    sessionStorage.removeItem('scrollPosition');
                }, 100);
            }
        }

        // 在页面卸载前保存滚动位置
        window.addEventListener('beforeunload', saveScrollPosition);
        
        // 初始化标题文字跳动动画
        function initTitleAnimation() {
            const titleElement = document.getElementById('animatedTitle');
            const textSpan = titleElement.querySelector('span');
            const text = textSpan.textContent;
            
            // 清空原有文本
            textSpan.textContent = '';
            
            // 将每个字符包裹在span中
            for (let i = 0; i < text.length; i++) {
                const charSpan = document.createElement('span');
                charSpan.className = 'title-char';
                charSpan.textContent = text[i];
                // 为每个字符设置不同的动画延迟，形成顺序跳动效果
                charSpan.style.animationDelay = `${i * 0.1}s`;
                textSpan.appendChild(charSpan);
            }
        }
        
        // 初始化编辑按钮事件
        function initEditButton() {
            const editBtn = document.getElementById('editRecordBtn');
            
            // 确保按钮初始状态正确
            updateEditButtonState();
            
            function handleEditClick() {
                if (selectedRecordIndices.length !== 1) {
                    showNotification('请选择一条记录进行编辑', 'info');
                    return;
                }
                
                const recordIndex = selectedRecordIndices[0];
                const record = repairRecords[recordIndex];
                
                if (!record) {
                    showNotification('未找到选中的记录', 'error');
                    return;
                }
                
                // 保存当前编辑的记录索引
                currentEditingIndex = recordIndex;
                
                // 填充表单
                document.getElementById('username').value = record.username || '';
                document.getElementById('employeeId').value = record.employeeId || '';
                document.getElementById('email').value = record.email || '';
                document.getElementById('laptopModelInput').value = record.laptopModel || '';
                document.getElementById('serialNumber').value = record.serialNumber || '';
                document.getElementById('faultDescription').value = record.faultDescription || '';
                document.getElementById('solveDate').value = record.solveDate || '';
                document.getElementById('comment').value = record.comment || '';
                
                // 设置状态
                const statusPill = document.querySelector(`#statusSelector [data-status="${record.status}"]`);
                if (statusPill) {
                    statusPill.click();
                }
                
                // 更改添加按钮文本为"更新记录"
                const addBtn = document.getElementById('addRecordBtn');
                addBtn.innerHTML = '<i class="fa fa-save mr-2"></i>更新记录';
                addBtn.dataset.action = 'update';
                
                // 滚动到表单顶部
                document.querySelector('form').scrollIntoView({ behavior: 'smooth' });
                
                showNotification('请编辑记录信息', 'info');
            }
            
            // 先移除可能存在的事件监听，避免重复绑定
            editBtn.removeEventListener('click', handleEditClick);
            // 添加新的事件监听
            editBtn.addEventListener('click', handleEditClick);
        }
        
        // 更新编辑按钮状态
        function updateEditButtonState() {
            const editBtn = document.getElementById('editRecordBtn');
            
            if (selectedRecordIndices.length === 1) {
                editBtn.disabled = false;
                editBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                editBtn.disabled = true;
                editBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }
        
        // 初始化删除选中按钮 - 修复按钮无响应问题
        function initDeleteSelectedButton() {
            const deleteBtn = document.getElementById('deleteSelectedBtn');
            
            // 确保按钮初始状态正确
            updateDeleteButtonState();
            
            // 使用命名函数而非匿名函数，确保可以正确移除事件监听
            function handleDeleteClick() {
                if (selectedRecordIndices.length === 0) {
                    showNotification('请先选择要删除的记录', 'info');
                    return;
                }
                
                const userConfirmed = confirm(`确定要删除选中的 ${selectedRecordIndices.length} 条记录吗？此操作不可恢复！`);
                if (userConfirmed) {
                    // 按降序删除，避免索引错乱
                    selectedRecordIndices.sort((a, b) => b - a).forEach(index => {
                        repairRecords.splice(index, 1);
                    });
                    
                    // 清空选中状态
                    selectedRecordIndices = [];
                    
                    // 重置编辑状态
                    resetEditState();
                    
                    // 保存到localStorage
                    saveRecordsToStorage();
                    
                    // 更新界面
                    updateRecordsTable();
                    updateRecentRecords();
                    updatePaginationControls();
                    updateDeleteButtonState();
                    updateEditButtonState();
                    
                    showNotification(`成功删除 ${selectedRecordIndices.length} 条记录`, 'success');
                }
            }
            
            // 先移除可能存在的事件监听，避免重复绑定
            deleteBtn.removeEventListener('click', handleDeleteClick);
            // 添加新的事件监听
            deleteBtn.addEventListener('click', handleDeleteClick);
        }
        
        // 重置编辑状态
        function resetEditState() {
            currentEditingIndex = -1;
            const addBtn = document.getElementById('addRecordBtn');
            addBtn.innerHTML = '<i class="fa fa-plus-circle mr-2"></i>添加记录';
            addBtn.removeAttribute('data-action');
        }
        
        // 更新删除按钮状态
        function updateDeleteButtonState() {
            const deleteBtn = document.getElementById('deleteSelectedBtn');
            
            if (selectedRecordIndices.length > 0) {
                deleteBtn.disabled = false;
                deleteBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                deleteBtn.disabled = true;
                deleteBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }
        
        // 初始化主题模式
        function initThemeMode() {
            const themeToggle = document.getElementById('themeToggle');
            
            // 检查用户偏好或保存的设置
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            // 应用保存的主题或系统偏好
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
            
            // 添加主题切换事件
            themeToggle.addEventListener('click', toggleTheme);
        }
        
        // 切换主题模式
        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            
            // 平滑过渡动画
            document.body.style.transition = 'background-color 0.3s ease';
            
            // 显示主题切换通知
            showNotification(`已切换到${isDark ? '深色' : '浅色'}模式`, 'success');
        }
        
        // 专门为清除记录按钮设置事件监听
        function setupClearRecordsButton() {
            // 使用setTimeout确保DOM完全加载
            setTimeout(() => {
                const clearBtn = document.getElementById('clearRecordsBtn');
                
                if (clearBtn) {
                    console.log('找到清除记录按钮，设置点击事件');
                    
                    // 先移除可能存在的事件监听，避免重复绑定
                    clearBtn.removeEventListener('click', handleClearRecords);
                    
                    // 添加新的事件监听
                    clearBtn.addEventListener('click', handleClearRecords);
                    
                    // 测试按钮是否可用
                    if (clearBtn.disabled) {
                        console.log('清除记录按钮处于禁用状态');
                        clearBtn.disabled = false;
                    }
                } else {
                    console.error('未找到清除记录按钮！');
                    // 如果找不到按钮，尝试在控制台创建一个临时按钮用于测试
                    createDebugClearButton();
                }
            }, 100);
        }
        
        // 创建调试用的清除记录按钮（仅在控制台可见）
        function createDebugClearButton() {
            console.log('创建调试用清除记录按钮');
            const debugBtn = document.createElement('button');
            debugBtn.id = 'debugClearBtn';
            debugBtn.textContent = '调试：清除记录';
            debugBtn.style.position = 'fixed';
            debugBtn.style.top = '10px';
            debugBtn.style.right = '10px';
            debugBtn.style.zIndex = '9999';
            debugBtn.style.padding = '8px 16px';
            debugBtn.style.backgroundColor = '#F53F3F';
            debugBtn.style.color = 'white';
            debugBtn.style.border = 'none';
            debugBtn.style.borderRadius = '4px';
            debugBtn.style.cursor = 'pointer';
            
            debugBtn.addEventListener('click', handleClearRecords);
            document.body.appendChild(debugBtn);
        }
        
        // 初始化其他事件监听
        function initOtherEventListeners() {
            // 表单提交事件
            document.getElementById('repairForm').addEventListener('submit', handleFormSubmit);
            
            // 下载Excel按钮事件
            document.getElementById('downloadExcelBtn').addEventListener('click', downloadExcel);
            
            // 上传Excel文件事件
            document.getElementById('excelFile').addEventListener('change', handleExcelUpload);
            
            // 重置按钮事件 - 重置状态选择器
            document.querySelector('button[type="reset"]').addEventListener('click', () => {
                setTimeout(() => {
                    const defaultPill = document.querySelector('#statusSelector [data-status="维修中"]');
                    if (defaultPill) {
                        defaultPill.click();
                    }
                    // 重置编辑状态
                    resetEditState();
                }, 10);
            });
        }
        
        // 从localStorage加载记录
        function loadRecordsFromStorage() {
            console.log('尝试从localStorage加载记录');
            const savedRecords = localStorage.getItem('laptopRepairRecords');
            if (savedRecords) {
                try {
                    repairRecords = JSON.parse(savedRecords);
                    console.log(`成功加载 ${repairRecords.length} 条记录`);
                    // 更新表格和最近记录列表
                    updateRecordsTable();
                    updateRecentRecords();
                    updateStatistics();
                } catch (e) {
                    console.error('加载记录失败:', e);
                    repairRecords = [];
                    // 清除损坏的存储数据
                    localStorage.removeItem('laptopRepairRecords');
                }
            } else {
                console.log('localStorage中没有记录');
                repairRecords = [];
            }
        }
        
        // 保存记录到localStorage
        function saveRecordsToStorage() {
            try {
                localStorage.setItem('laptopRepairRecords', JSON.stringify(repairRecords));
                console.log(`已保存 ${repairRecords.length} 条记录到localStorage`);
                updateStatistics();
            } catch (e) {
                console.error('保存记录失败:', e);
                showNotification('记录保存失败，请检查浏览器存储设置', 'error');
            }
        }
        
        // 初始化状态选择器
        function initStatusSelector() {
            const statusSelector = document.getElementById('statusSelector');
            const statusInput = document.getElementById('status');
            const statusPills = statusSelector.querySelectorAll('.status-pill');
            
            // 点击状态标签切换选中状态
            statusPills.forEach(pill => {
                pill.addEventListener('click', () => {
                    // 移除所有选中状态
                    statusPills.forEach(p => p.classList.remove('status-pill-active', 'ring-2', 'ring-offset-1'));
                    
                    // 添加当前选中状态
                    pill.classList.add('status-pill-active', 'ring-2');
                    
                    // 设置隐藏字段的值
                    const statusValue = pill.getAttribute('data-status');
                    pill.classList.add(`ring-${getStatusColorClass(statusValue)}`);
                    statusInput.value = statusValue;
                });
            });
            
            // 默认选中"维修中"
            const defaultPill = statusSelector.querySelector('[data-status="维修中"]');
            if (defaultPill) {
                defaultPill.click();
            }
        }
        
        // 初始化笔记本型号下拉选项 - 修复层级问题
        function initLaptopModelDropdown() {
            const modelOptions = document.getElementById('modelOptions');
            const modelInput = document.getElementById('laptopModelInput');
            const dropdown = document.getElementById('laptopModelDropdown');
            const dropdownArrow = document.getElementById('dropdownArrow');
            const dropdownToggle = document.getElementById('dropdownToggle');
            const modelSearch = document.getElementById('modelSearch');
            
            // 渲染所有型号选项
            renderModelOptions(laptopModels);
            
            // 点击输入框显示/隐藏下拉菜单
            modelInput.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleDropdown();
            });
            
            // 点击下拉箭头显示/隐藏下拉菜单
            dropdownToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleDropdown();
            });
            
            // 搜索功能
            modelSearch.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredModels = laptopModels.filter(model => 
                    model.toLowerCase().includes(searchTerm)
                );
                renderModelOptions(filteredModels);
            });
            
            // 点击其他区域关闭下拉菜单
            document.addEventListener('click', () => {
                closeDropdown();
            });
            
            // 防止下拉菜单内部点击关闭菜单
            dropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
            
            // 键盘导航
            modelInput.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    openDropdown();
                    const firstOption = modelOptions.querySelector('li');
                    if (firstOption) {
                        firstOption.classList.add('dropdown-active');
                        firstOption.scrollIntoView({ block: 'nearest' });
                    }
                }
            });
            
            // 处理下拉菜单内的键盘事件
            dropdown.addEventListener('keydown', (e) => {
                const activeOption = modelOptions.querySelector('.dropdown-active');
                const options = Array.from(modelOptions.querySelectorAll('li'));
                const activeIndex = options.indexOf(activeOption);
                
                switch(e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        if (activeOption) activeOption.classList.remove('dropdown-active');
                        const nextIndex = activeIndex === -1 ? 0 : (activeIndex + 1) % options.length;
                        options[nextIndex].classList.add('dropdown-active');
                        options[nextIndex].scrollIntoView({ block: 'nearest' });
                        break;
                        
                    case 'ArrowUp':
                        e.preventDefault();
                        if (activeOption) activeOption.classList.remove('dropdown-active');
                        const prevIndex = activeIndex === -1 ? options.length - 1 : (activeIndex - 1 + options.length) % options.length;
                        options[prevIndex].classList.add('dropdown-active');
                        options[prevIndex].scrollIntoView({ block: 'nearest' });
                        break;
                        
                    case 'Enter':
                        e.preventDefault();
                        if (activeOption) {
                            selectModel(activeOption.dataset.model);
                        }
                        break;
                        
                    case 'Escape':
                        closeDropdown();
                        modelInput.focus();
                        break;
                }
            });
            
            // 渲染选项函数
            function renderModelOptions(models) {
                modelOptions.innerHTML = '';
                
                if (models.length === 0) {
                    const noResult = document.createElement('li');
                    noResult.className = 'px-3 py-2 text-gray-400 dark:text-gray-500 italic';
                    noResult.textContent = '没有找到匹配的型号';
                    modelOptions.appendChild(noResult);
                    return;
                }
                
                models.forEach(model => {
                    const li = document.createElement('li');
                    li.className = 'px-3 py-2 rounded-md dropdown-item-hover dark:text-gray-300';
                    li.textContent = model;
                    li.dataset.model = model;
                    
                    // 点击选择型号
                    li.addEventListener('click', () => {
                        selectModel(model);
                    });
                    
                    // 鼠标悬停高亮
                    li.addEventListener('mouseenter', () => {
                        modelOptions.querySelectorAll('.dropdown-active').forEach(el => {
                            el.classList.remove('dropdown-active');
                        });
                        li.classList.add('dropdown-active');
                    });
                    
                    modelOptions.appendChild(li);
                });
            }
            
            // 选择型号
            function selectModel(model) {
                modelInput.value = model;
                closeDropdown();
                // 移动焦点到下一个输入框
                document.getElementById('serialNumber').focus();
            }
            
            // 打开下拉菜单
            function openDropdown() {
                dropdown.classList.remove('hidden');
                dropdownArrow.classList.add('rotate-180');
                modelSearch.focus();
                modelSearch.value = '';
                renderModelOptions(laptopModels);
            }
            
            // 关闭下拉菜单
            function closeDropdown() {
                dropdown.classList.add('hidden');
                dropdownArrow.classList.remove('rotate-180');
                modelOptions.querySelectorAll('.dropdown-active').forEach(el => {
                    el.classList.remove('dropdown-active');
                });
            }
            
            // 切换下拉菜单状态
            function toggleDropdown() {
                if (dropdown.classList.contains('hidden')) {
                    openDropdown();
                } else {
                    closeDropdown();
                    modelInput.focus();
                }
            }
        }
        
        // 处理清除记录
        function handleClearRecords() {
            console.log('=== 进入清除记录函数 ===');
            console.log(`当前记录数量: ${repairRecords.length}`);
            
            if (repairRecords.length === 0) {
                console.log('没有记录可清除');
                showNotification('没有可清除的记录', 'info');
                return;
            }
            
            console.log('显示确认对话框');
            const userConfirmed = confirm('确定要清除所有记录吗？此操作不可恢复！');
            console.log(`用户确认结果: ${userConfirmed}`);
            
            if (userConfirmed) {
                console.log('用户确认清除，执行清除操作');
                
                // 清空记录
                repairRecords = [];
                // 清空选中状态
                selectedRecordIndices = [];
                // 重置编辑状态
                resetEditState();
                
                console.log('记录数组已清空');
                
                // 重置分页
                paginationConfig.currentPage = 1;
                
                // 强制清除localStorage
                try {
                    localStorage.removeItem('laptopRepairRecords');
                    console.log('localStorage中的记录已清除');
                } catch (e) {
                    console.error('清除localStorage失败:', e);
                }
                
                // 强制更新界面
                console.log('开始更新界面...');
                updateRecordsTable();
                updateRecentRecords();
                updatePaginationControls();
                updateDeleteButtonState();
                updateEditButtonState();
                updateStatistics();
                
                showNotification('所有记录已清除', 'success');
                console.log('清除记录操作完成');
            } else {
                console.log('用户取消了清除操作');
            }
        }
        
        // 初始化分页控件事件
        function initPaginationEvents() {
            // 上一页按钮
            document.getElementById('prevPage').addEventListener('click', () => {
                if (paginationConfig.currentPage > 1) {
                    paginationConfig.currentPage--;
                    // 分页变化时清除选中状态
                    selectedRecordIndices = [];
                    // 重置编辑状态
                    resetEditState();
                    updateDeleteButtonState();
                    updateEditButtonState();
                    updateRecordsTable();
                    updatePaginationControls();
                }
            });
            
            // 下一页按钮
            document.getElementById('nextPage').addEventListener('click', () => {
                const totalPages = getTotalPages();
                if (paginationConfig.currentPage < totalPages) {
                    paginationConfig.currentPage++;
                    // 分页变化时清除选中状态
                    selectedRecordIndices = [];
                    // 重置编辑状态
                    resetEditState();
                    updateDeleteButtonState();
                    updateEditButtonState();
                    updateRecordsTable();
                    updatePaginationControls();
                }
            });
        }
        
        // 获取总页数
        function getTotalPages() {
            return Math.ceil(repairRecords.length / paginationConfig.pageSize);
        }
        
        // 更新分页控件
        function updatePaginationControls() {
            const totalPages = getTotalPages();
            const pageNumbersContainer = document.getElementById('pageNumbers');
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            const paginationControls = document.getElementById('paginationControls');
            const showingRangeEl = document.getElementById('showingRange');
            const totalRecordsEl = document.getElementById('totalRecords');
            
            // 隐藏或显示分页控件
            if (repairRecords.length <= paginationConfig.pageSize) {
                paginationControls.classList.add('hidden');
                return;
            }
            paginationControls.classList.remove('hidden');
            
            // 更新记录统计信息
            const start = (paginationConfig.currentPage - 1) * paginationConfig.pageSize + 1;
            const end = Math.min(start + paginationConfig.pageSize - 1, repairRecords.length);
            showingRangeEl.textContent = `${start} - ${end}`;
            totalRecordsEl.textContent = repairRecords.length;
            
            // 更新页码按钮
            pageNumbersContainer.innerHTML = '';
            
            // 最多显示5个页码按钮
            let startPage = Math.max(1, paginationConfig.currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            // 如果接近末尾，调整起始页码
            if (endPage - startPage < 4 && startPage > 1) {
                startPage = Math.max(1, endPage - 4);
            }
            
            // 添加页码按钮
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `pagination-item ${i === paginationConfig.currentPage ? 'active' : ''} dark:border-gray-600 dark:text-gray-300`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    paginationConfig.currentPage = i;
                    // 分页变化时清除选中状态
                    selectedRecordIndices = [];
                    // 重置编辑状态
                    resetEditState();
                    updateDeleteButtonState();
                    updateEditButtonState();
                    updateRecordsTable();
                    updatePaginationControls();
                });
                pageNumbersContainer.appendChild(pageBtn);
            }
            
            // 更新上一页/下一页按钮状态
            prevPageBtn.disabled = paginationConfig.currentPage === 1;
            prevPageBtn.classList.toggle('disabled', paginationConfig.currentPage === 1);
            
            nextPageBtn.disabled = paginationConfig.currentPage === totalPages;
            nextPageBtn.classList.toggle('disabled', paginationConfig.currentPage === totalPages);
        }
        
        // 处理表单提交 - 修改记录添加位置
        function handleFormSubmit(e) {
            e.preventDefault();
            
            // 获取表单数据
            const formData = {
                username: document.getElementById('username').value.trim(),
                employeeId: document.getElementById('employeeId').value.trim(),
                email: document.getElementById('email').value.trim(),
                laptopModel: document.getElementById('laptopModelInput').value.trim(),
                serialNumber: document.getElementById('serialNumber').value.trim(),
                faultDescription: document.getElementById('faultDescription').value.trim(),
                solveDate: document.getElementById('solveDate').value,
                status: document.getElementById('status').value,
                comment: document.getElementById('comment').value.trim()
            };
            
            const addBtn = document.getElementById('addRecordBtn');
            const isUpdate = addBtn.dataset.action === 'update';
            
            if (isUpdate && currentEditingIndex !== -1) {
                // 更新现有记录
                repairRecords[currentEditingIndex] = formData;
                showNotification('记录更新成功！', 'success');
            } else {
                // 添加新记录
                repairRecords.unshift(formData);
                showNotification('记录添加成功！', 'success');
            }
            
            // 清空选中状态
            selectedRecordIndices = [];
            // 重置编辑状态
            resetEditState();
            
            // 保存到localStorage
            saveRecordsToStorage();
            
            // 确保新记录可见，重置到第一页
            paginationConfig.currentPage = 1;
            
            // 更新界面
            updateRecordsTable();
            updateRecentRecords();
            updatePaginationControls();
            updateDeleteButtonState();
            updateEditButtonState();
            updateStatistics();
            
            // 重置表单（保留部分字段）
            const faultField = document.getElementById('faultDescription');
            const form = e.target;
            form.reset();
            document.getElementById('solveDate').value = new Date().toISOString().split('T')[0];
            // 重置状态选择器
            const defaultPill = document.querySelector('#statusSelector [data-status="维修中"]');
            if (defaultPill) {
                defaultPill.click();
            }
            faultField.focus();
            
            // 添加记录后滚动到顶部
            scrollToTop();
        }
        
        // 更新记录表格（带分页）- 添加选中状态图标
        function updateRecordsTable() {
            console.log('更新记录表格，当前记录数:', repairRecords.length);
            const tableBody = document.getElementById('recordsTableBody');
            
            // 清空表格
            tableBody.innerHTML = '';
            
            // 如果没有记录
            if (repairRecords.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="10" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400 italic">暂无记录，请添加维修记录</td>
                    </tr>
                `;
                return;
            }
            
            // 计算当前页的记录
            const startIndex = (paginationConfig.currentPage - 1) * paginationConfig.pageSize;
            const endIndex = Math.min(startIndex + paginationConfig.pageSize, repairRecords.length);
            const currentPageRecords = repairRecords.slice(startIndex, endIndex);
            
            // 填充表格数据
            currentPageRecords.forEach((record, index) => {
                // 计算原始索引（用于编辑状态）
                const originalIndex = startIndex + index;
                // 检查是否选中
                const isSelected = selectedRecordIndices.includes(originalIndex);
                
                const row = document.createElement('tr');
                row.className = `${index % 2 === 0 ? 'bg-white/60 dark:bg-gray-800/60' : 'bg-gray-50/60 dark:bg-gray-700/60'} ${isSelected ? 'table-row-selected' : ''} transition-colors cursor-pointer backdrop-blur-sm`;
                
                // 添加行点击事件 - 切换选中状态
                row.addEventListener('click', (e) => {
                    // 如果点击的是状态标签，不触发选择事件
                    if (!e.target.closest('.status-pill') && !e.target.closest('.status-editor-container')) {
                        toggleRecordSelection(originalIndex, row);
                    }
                });
                
                // 创建选择列单元格（包含选中状态图标）
                const selectCell = document.createElement('td');
                selectCell.className = 'px-4 py-3 whitespace-nowrap text-center';
                selectCell.innerHTML = isSelected 
                    ? `<i class="fa fa-check-circle text-primary text-lg"></i>` 
                    : `<i class="fa fa-circle-o text-gray-300 dark:text-gray-600 text-lg"></i>`;
                
                // 状态单元格
                const statusCell = document.createElement('td');
                statusCell.className = 'px-4 py-3 whitespace-nowrap';
                statusCell.innerHTML = `
                    <div class="status-container inline-flex items-center gap-2">
                        <span class="status-pill ${getStatusBgClass(record.status)} ${getStatusTextClass(record.status)} cursor-pointer hover:shadow-md transition-all duration-200" 
                            data-index="${originalIndex}"
                            data-status="${record.status}">
                            <i class="${getStatusIcon(record.status)} mr-1"></i>${record.status}
                        </span>
                    </div>
                `;
                statusCell.querySelector('.status-pill').addEventListener('click', (e) => {
                    e.stopPropagation(); // 阻止事件冒泡到行
                    openStatusEditor(originalIndex, statusCell);
                });
                
                // 创建其他单元格
                const cells = [
                    `<td class="px-4 py-3 whitespace-nowrap dark:text-gray-300">${record.username}</td>`,
                    `<td class="px-4 py-3 whitespace-nowrap dark:text-gray-300">${record.employeeId}</td>`,
                    `<td class="px-4 py-3 whitespace-nowrap dark:text-gray-300">${record.email}</td>`,
                    `<td class="px-4 py-3 whitespace-nowrap dark:text-gray-300">${record.laptopModel}</td>`,
                    `<td class="px-4 py-3 whitespace-nowrap dark:text-gray-300">${record.serialNumber}</td>`,
                    `<td class="px-4 py-3 break-words dark:text-gray-300" style="word-break: break-word; white-space: normal; min-width: 200px;">${record.faultDescription}</td>`,
                    `<td class="px-4 py-3 whitespace-nowrap dark:text-gray-300">${record.solveDate}</td>`,
                    `<td class="px-4 py-3 break-words dark:text-gray-300" style="word-break: break-word; white-space: normal; min-width: 200px;">${record.comment || '-'}</td>`
                ];
                
                // 设置行内容
                row.innerHTML = cells.join('');
                
                // 插入选择列和状态列到正确位置
                row.insertBefore(selectCell, row.firstChild);
                // 修复：状态列在第8个位置，提交日期在第7个位置
                row.insertBefore(statusCell, row.children[8]);
                
                tableBody.appendChild(row);
            });
        }
        
        // 切换记录选中状态 - 同步更新选中图标
        function toggleRecordSelection(index, row) {
            const indexInArray = selectedRecordIndices.indexOf(index);
            
            if (indexInArray === -1) {
                // 选中记录
                selectedRecordIndices.push(index);
                row.classList.add('table-row-selected');
            } else {
                // 取消选中
                selectedRecordIndices.splice(indexInArray, 1);
                row.classList.remove('table-row-selected');
            }
            
            // 更新选择列图标
            const selectCell = row.querySelector('td:first-child');
            selectCell.innerHTML = selectedRecordIndices.includes(index)
                ? `<i class="fa fa-check-circle text-primary text-lg"></i>`
                : `<i class="fa fa-circle-o text-gray-300 dark:text-gray-600 text-lg"></i>`;
            
            // 更新按钮状态
            updateDeleteButtonState();
            updateEditButtonState();
        }
        
        // 获取状态对应的颜色类
        function getStatusColorClass(status) {
            switch(status) {
                case '已解决':
                    return 'statusResolved';
                case '维修中':
                    return 'statusRepairing';
                case '待配件':
                    return 'statusWaiting';
                case '过保无法维修':
                    return 'statusUnrepairable';
                default:
                    return 'gray-500';
            }
        }
        
        // 获取状态对应的背景类
        function getStatusBgClass(status) {
            const color = getStatusColorClass(status);
            return `bg-${color}/10 border border-${color}/30`;
        }
        
        // 获取状态对应的文本类
        function getStatusTextClass(status) {
            const color = getStatusColorClass(status);
            return `text-${color}`;
        }
        
        // 获取状态对应的图标
        function getStatusIcon(status) {
            switch(status) {
                case '已解决':
                    return 'fa fa-check-circle';
                case '维修中':
                    return 'fa fa-cog';
                case '待配件':
                    return 'fa fa-clock-o';
                case '过保无法维修':
                    return 'fa fa-times-circle';
                default:
                    return 'fa fa-question-circle';
            }
        }
        
        // 更新最近记录列表
        function updateRecentRecords() {
            const container = document.getElementById('recentRecords');
            container.innerHTML = '';
            
            // 因为新记录已经在最前面，不需要再反转数组
            const recent = repairRecords.slice(0, 5);
            
            if (recent.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic text-center py-4">暂无记录</p>';
                return;
            }
            
            recent.forEach(record => {
                const recordEl = document.createElement('div');
                recordEl.className = 'p-3 bg-white/60 dark:bg-gray-700/60 rounded-lg border border-gray-100/50 dark:border-gray-600/50 backdrop-blur-sm bounce-in';
                recordEl.innerHTML = `
                    <p class="font-medium dark:text-gray-200">${record.username} - ${record.laptopModel}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-2">${record.faultDescription.substring(0, 50)}${record.faultDescription.length > 50 ? '...' : ''}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center">
                        ${record.solveDate} · 
                        <span class="ml-1 status-pill ${getStatusBgClass(record.status)} ${getStatusTextClass(record.status)}">
                            <i class="${getStatusIcon(record.status)} mr-1"></i>${record.status}
                        </span>
                    </p>
                `;
                container.appendChild(recordEl);
            });
        }
        
        // 下载Excel文件
        function downloadExcel() {
            if (repairRecords.length === 0) {
                showNotification('没有可导出的记录，请先添加记录', 'error');
                return;
            }
            
            // 准备要导出的所有数据（保持当前顺序）
            const data = [
                headers.slice(1), // 表头（排除"选择"列）
                ...repairRecords.map(record => [
                    record.username,
                    record.employeeId,
                    record.email,
                    record.laptopModel,
                    record.serialNumber,
                    record.faultDescription,
                    record.solveDate,
                    record.status,
                    record.comment
                ])
            ];
            
            // 创建工作簿和工作表
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "维修记录");
            
            // 生成文件名（包含当前日期）
            const dateStr = new Date().toISOString().split('T')[0];
            const fileName = `笔记本维修记录_${dateStr}.xlsx`;
            
            // 下载文件
            XLSX.writeFile(wb, fileName);
            
            showNotification('Excel文件已生成并下载', 'success');
        }
        
        // 处理Excel文件上传
        function handleExcelUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // 获取第一个工作表
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // 转换为JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // 验证表头
                    if (jsonData.length === 0) {
                        showNotification('上传的Excel文件为空', 'error');
                        return;
                    }
                    
                    const fileHeaders = jsonData[0];
                    let headerMatch = true;
                    
                    // 跳过"选择"列进行表头验证
                    headers.slice(1).forEach((header, index) => {
                        if (fileHeaders[index] !== header) {
                            headerMatch = false;
                        }
                    });
                    
                    if (!headerMatch) {
                        showNotification('Excel文件表头格式不匹配，请检查是否包含"故障描述"字段', 'error');
                        return;
                    }
                    
                    // 提取数据（跳过表头）
                    const newRecords = [];
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row.length >= 8) { // 确保有足够的数据
                            newRecords.push({
                                username: row[0] || '',
                                employeeId: row[1] || '',
                                email: row[2] || '',
                                laptopModel: row[3] || '',
                                serialNumber: row[4] || '',
                                faultDescription: row[5] || '',
                                solveDate: row[6] || '',
                                status: row[7] || '',
                                comment: row[8] || ''
                            });
                        }
                    }
                    
                    // 将导入的记录添加到现有记录的前面
                    repairRecords = [...newRecords, ...repairRecords];
                    
                    // 清空选中状态
                    selectedRecordIndices = [];
                    // 重置编辑状态
                    resetEditState();
                    
                    // 保存到localStorage
                    saveRecordsToStorage();
                    
                    // 更新界面
                    updateRecordsTable();
                    updateRecentRecords();
                    updatePaginationControls();
                    updateDeleteButtonState();
                    updateEditButtonState();
                    updateStatistics();
                    
                    showNotification(`成功导入 ${newRecords.length} 条记录`, 'success');
                    
                    // 清空文件输入
                    e.target.value = '';
                    
                    // 导入后滚动到顶部
                    scrollToTop();
                } catch (error) {
                    console.error('解析Excel文件出错:', error);
                    showNotification('解析Excel文件出错，请检查文件格式', 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // 打开状态编辑器
        function openStatusEditor(index, cell) {
            const record = repairRecords[index];
            const statusOptions = [
                {value: '已解决', icon: 'fa-check-circle'},
                {value: '维修中', icon: 'fa-cog'},
                {value: '待配件', icon: 'fa-clock-o'},
                {value: '过保无法维修', icon: 'fa-times-circle'}
            ];
            
            // 创建编辑容器
            const editorContainer = document.createElement('div');
            editorContainer.className = 'status-editor-container flex flex-col gap-2 w-full';
            
            // 添加提示文字
            const hint = document.createElement('div');
            hint.className = 'text-xs text-gray-500 dark:text-gray-400 mb-1';
            hint.innerHTML = '<i class="fa fa-edit mr-1"></i>选择新状态：';
            editorContainer.appendChild(hint);
            
            // 创建状态选择器
            const statusSelector = document.createElement('div');
            statusSelector.className = 'flex flex-wrap gap-2';
            
            statusOptions.forEach(option => {
                const pill = document.createElement('span');
                const isActive = option.value === record.status;
                pill.className = `status-pill ${getStatusBgClass(option.value)} ${getStatusTextClass(option.value)} transition-all duration-200 ${isActive ? 'status-pill-active ring-2 ring-' + getStatusColorClass(option.value) : ''}`;
                pill.dataset.status = option.value;
                pill.innerHTML = `<i class="${option.icon} mr-1"></i>${option.value}`;
                
                pill.addEventListener('click', (e) => {
                    e.stopPropagation(); // 阻止事件冒泡到行
                    updateStatus(index, option.value, cell, true);
                });
                
                statusSelector.appendChild(pill);
            });
            
            editorContainer.appendChild(statusSelector);
            
            // 替换单元格内容
            cell.innerHTML = '';
            cell.appendChild(editorContainer);
        }
        
        // 更新状态
        function updateStatus(index, newStatus, cell, showNotify = true) {
            if (index >= 0 && index < repairRecords.length) {
                const oldStatus = repairRecords[index].status;
                repairRecords[index].status = newStatus;
                
                // 保存到localStorage
                saveRecordsToStorage();
                
                // 更新单元格显示
                cell.innerHTML = `
                    <div class="status-container inline-flex items-center gap-2">
                        <span class="status-pill ${getStatusBgClass(newStatus)} ${getStatusTextClass(newStatus)} cursor-pointer hover:shadow-md transition-all duration-200" 
                            data-index="${index}"
                            data-status="${newStatus}">
                            <i class="${getStatusIcon(newStatus)} mr-1"></i>${newStatus}
                        </span>
                    </div>
                `;
                
                // 重新绑定点击事件
                cell.querySelector('.status-pill').addEventListener('click', (e) => {
                    e.stopPropagation(); // 阻止事件冒泡到行
                    openStatusEditor(index, cell);
                });
                
                // 更新最近记录列表
                updateRecentRecords();
                
                // 如果当前页记录受影响，刷新表格
                const startIndex = (paginationConfig.currentPage - 1) * paginationConfig.pageSize;
                const endIndex = startIndex + paginationConfig.pageSize;
                if (index >= startIndex && index < endIndex) {
                    updateRecordsTable();
                }
                
                // 只有在状态真正改变且需要通知时才显示通知
                if (showNotify && oldStatus !== newStatus) {
                    showNotification('状态已更新', 'success');
                }
            }
        }
        
        // 显示通知提示
        function showNotification(message, type = 'info') {
            // 创建通知元素
            const notification = document.createElement('div');
            let bgColor, icon;
            
            switch(type) {
                case 'success':
                    bgColor = 'bg-success';
                    icon = 'fa-check-circle';
                    break;
                case 'error':
                    bgColor = 'bg-danger';
                    icon = 'fa-exclamation-circle';
                    break;
                default:
                    bgColor = 'bg-primary';
                    icon = 'fa-info-circle';
            }
            
            notification.className = `fixed bottom-5 right-5 px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-500 translate-y-10 opacity-0 flex items-center ${bgColor} text-white bounce-in`;
            notification.innerHTML = `<i class="fa ${icon} mr-2"></i> ${message}`;
            
            // 添加到页面
            document.body.appendChild(notification);
            
            // 显示通知
            setTimeout(() => {
                notification.classList.remove('translate-y-10', 'opacity-0');
            }, 10);
            
            // 3秒后隐藏通知
            setTimeout(() => {
                notification.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        }
        
        // 暴露全局函数用于调试
        window.debugClearRecords = handleClearRecords;
        window.getRecordCount = () => repairRecords.length;
        window.showStatisticsModal = showStatisticsModal;
        window.scrollToTop = scrollToTop;
    </script>
</body>
</html>
